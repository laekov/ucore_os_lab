Lab4 实验报告
===
## 练习零
用 ag 配合 vimdiff 更方便.
## 练习一
在 `alloc_proc()` 函数中初始化一个 `proc_struct`. 将它的 `state` 设为 `PROC_UNINIT`, 然后将 `pid`, `kstack` 等东西全部设为 `0`. 因为是内核线程, 所以 `cr3` 与系统内核相同.
## 练习二
首先用练习一中的函数创建一个新的 `proc_struct`. 然后将它的父进程设为当前进程, 为它分配内核栈, 复制地址空间和代码. 

然后为当前线程分配 `pid`, 并把它插入到 `hash_list` 和 `proc_list` 中. 最后将进程统计数加一, 并把这个线程设为就绪状态.
## 练习三
`proc_run` 中完成了进程 (或线程) 的切换. 

当需要运行的进程和当前正在运行的进程不同时开始切换.

首先停止中断处理机制 (相当于上锁, 避免多次切换).

然后将系统栈切换为下一个进程的系统栈.

然后转换 `cr3`.

然后使用 cpu 制造者提供的 `switch_to` 来切换寄存器.

最后解锁中断.